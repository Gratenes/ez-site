<!DOCTYPE html>
<html lang="en">
<head>
  <title> Tiktok Video Downloader </title>
  <meta property="og:site_name" content="Made by Chance#0002 and wearr#3596">
  <meta name="twitter:card"                       content="player">
  <meta name="twitter:title"                      content="<%- formattedOutput.user.name || 'Unknown'%> <%- formattedOutput.user.username ? `(${formattedOutput.user.username})` : "" %>">
  <meta name="twitter:player:width"               content="720">
  <meta name="twitter:player:height"              content="480">
  <meta name="twitter:player:stream"              content="<%- formattedOutput.video %>">
  <meta name="twitter:player:stream:content_type" content="video/mp4"> 
  <link rel="stylesheet" href="/css/index.css">
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.0/css/all.css">
  <link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.4.0/css/sharp-regular.css">
  <script src="https://unpkg.com/artplayer/dist/artplayer.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>
  <h1 class="title"> Tiktok Video Embeder </h1>
  <h2 class="subtitle"> Made by Chance#0002 and wearr#3596 </h2>
  <p class="description">This API is designed to be used in Discord EX. https://tiktokez.com/@fribaru/video/7219762753165298990 </p>

  <div class="artplayer-container">
    <div class="artplayer-app"></div>
  </div>
  <div class="info-container">
    <span class="creator-name">Created by: <%- formattedOutput.user.name %></span>
  </div>
  <% if (formattedOutput.sound.name !== undefined) { %>
      <span class="sound-name">Sound: <%- formattedOutput.sound.name %></span>
  <% } %>
  <div class="stats-container">
    <span class="views"><i class="fa-sharp fa-regular fa-eye"></i>&nbsp;<%- parseInt(formattedOutput.stats.views).toLocaleString("en-US") %></span>
    <span class="likes"><i class="fa-regular fa-heart"></i>&nbsp;<%- parseInt(formattedOutput.stats.likes).toLocaleString("en-US") %></span>
    <span class="shares"><i class="fa-sharp fa-light fa-share"></i>&nbsp;<%- parseInt(formattedOutput.stats.shares).toLocaleString("en-US") %></span>
    <span class="comments"><i class="fa-regular fa-comment"></i>&nbsp;<%- parseInt(formattedOutput.stats.comments).toLocaleString("en-US") %></span>
  </div>
  <script>
    function create_UUID(){
    var dt = new Date().getTime();
    var uuid = 'xxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = (dt + Math.random()*16)%16 | 0;
        dt = Math.floor(dt/16);
        return (c=='x' ? r :(r&0x3|0x8)).toString(16);
    });
        return uuid;
    }
    var art = new Artplayer({
      container: '.artplayer-app',
      url: '<%- formattedOutput.video %>',
      cover: "<%- formattedOutput.cover.static %>",
      fullscreen: false,
      fullscreenWeb: true,
      airplay: true,
      theme: '#cb71ff',
      controls: [
        {
            position: 'right',
            html: '<i class="fa-regular fa-download"></i>',
            index: 1,
            tooltip: 'Download',
            style: {
                fontSize: "20px",
                marginTop: "-1px",
                color: "white",
                marginRight: "5px"
            },
            click: function () {
              fetch('<%- formattedOutput.video %>')
              .then(resp => resp.blob())
              .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                // the filename you want
                a.download = `TikTok_EZ.${create_UUID()}.mp4`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                console.log("File ") // or you know, something with better UX...
              })
              .catch((err) => console.log(err));
            },
        },
    ],
    });

  </script>
</body>
</html>